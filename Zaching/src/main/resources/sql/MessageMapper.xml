<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
		PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="MessageMapper">

	<resultMap type="message" id="messageSelectMap">
	<result property="messageId" column="message_id" jdbcType="INTEGER"/>
	 <result property="userId" column="user_id" jdbcType="INTEGER"/>
	 <result property="friendId" column="friend_id" jdbcType="INTEGER"/>
	<result property="content" column="content" jdbcType="VARCHAR"/>
	<result property="createdDate" column="created_date" jdbcType="DATE"/>
	
	
	</resultMap>
	
	<insert id="addMessage" parameterType="message">
	INSERT
	INTO MESSAGE(message_id , content , created_date,user_id,friend_id  )
	VALUES(
	seq_message_id.nextval, 
	#{content:VARCHAR} , 
	SYSDATE ,
	#{userId:INTEGER},
	#{friendId:INTEGER}
	)
	
	</insert>
	
	<delete id="deleteMessage" parameterType="message">
	DELETE
	FROM message WHERE message_id=#{messageId}
	
	
	</delete>
	
	<select id="getMessage" parameterType="int" resultMap="messageSelectMap">
	SELECT
	message_id,user_id,friend_id,content,created_date
	FROM message
	WHERE message_id=#{messageId}
	
	</select>	
	
	<select id="listMessage" parameterType="search" resultMap="messageSelectMap">
	SELECT *
	FROM 	(SELECT inner_table.*,ROWNUM AS row_seq
				FROM (SELECT message_id,user_id,friend_id,content,created_date
						FROM message
						<if test="searchCondition !=null">
						<where>
						<if test="searchCondition == 0 and searchKeyword !='' ">
							message_id=#{searchKeyword}
						</if>
						<if test="searchCondition == 1 and searchKeyword !='' ">
						friend_id=#{searchKeyword}
						</if>
						</where>
						</if>
						ORDER BY message_id DESC) inner_table
						WHERE ROWNUM &lt;=#{endRowNum})
							WHERE row_seq BETWEEN #{startRowNum} AND #{endRowNum}
	
	</select>
	
	 	<select  id="getTotalCount"  parameterType="search"	 resultType="int">
	  	SELECT COUNT(*)
	  	FROM( SELECT message_id ,user_id,friend_id, created_date 
	  			FROM message ) countTable						
	 </select>
	
	
	
	
	
	
	
	</mapper>